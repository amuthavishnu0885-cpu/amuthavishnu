<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Arulmigu Narayana Swamy Temple - Donation Portal (Cloud)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+Tamil:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    [lang="ta"] body, [lang="ta"] button, [lang="ta"] input, [lang="ta"] textarea, [lang="ta"] h1, [lang="ta"] h2, [lang="ta"] p, [lang="ta"] label { font-family: 'Noto Sans Tamil', sans-serif; }
    .glass-card { background: rgba(255,255,255,0.75); backdrop-filter: blur(8px); border-radius: 12px; padding: 1.25rem; box-shadow: 0 6px 18px rgba(0,0,0,0.12); }
    .no-scrollbar::-webkit-scrollbar { display:none; } .no-scrollbar { -ms-overflow-style:none; scrollbar-width:none; }
    @media print { .no-print { display:none !important; } }
  </style>
</head>
<body class="bg-orange-50 min-h-screen">

<div id="app" class="max-w-6xl mx-auto p-6">
  <header class="mb-6">
    <div class="header-image bg-[url('https://placehold.co/1200x300/E67E22/FFFFFF?text=.')] bg-cover bg-center h-48 rounded-lg relative">
      <div class="absolute inset-0 bg-black/40 flex items-center justify-center rounded-lg">
        <h1 id="header-title" class="text-white text-3xl md:text-4xl font-bold" data-key="headerTitle">Arulmigu Narayana Swamy Temple Donation Portal</h1>
      </div>
    </div>
  </header>

  <nav class="mb-6 flex justify-between items-center no-print">
    <div class="flex gap-2">
      <button id="en-lang-btn" class="px-4 py-2 bg-orange-500 text-white rounded-md" data-key="englishBtn">English</button>
      <button id="ta-lang-btn" class="px-4 py-2 bg-green-600 text-white rounded-md" data-key="tamilBtn">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</button>
    </div>
    <div>
      <a href="#" id="admin-login-link" class="text-sm font-medium text-orange-700" data-key="adminLoginLink">Admin Login</a>
    </div>
  </nav>

  <main>
    <!-- Home -->
    <div id="home-page">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <section class="glass-card">
          <h2 class="text-2xl font-bold mb-4" data-key="formTitle">Make a Donation</h2>
          <form id="donation-form" class="space-y-3">
            <div><label class="block text-sm font-medium" data-key="donorNameLabel">Donor Name</label><input id="donorName" required placeholder-key="donorNamePlaceholder" class="mt-1 block w-full p-2 border rounded-md"></div>
            <div><label class="block text-sm font-medium" data-key="addressLabel">Address</label><textarea id="address" rows="2" class="mt-1 block w-full p-2 border rounded-md" placeholder-key="addressPlaceholder"></textarea></div>
            <div><label class="block text-sm font-medium" data-key="phoneLabel">Phone Number</label><input id="phone" type="tel" class="mt-1 block w-full p-2 border rounded-md" placeholder-key="phonePlaceholder"></div>
            <div><label class="block text-sm font-medium" data-key="emailLabel">Email ID</label><input id="email" type="email" class="mt-1 block w-full p-2 border rounded-md" placeholder-key="emailPlaceholder"></div>
            <div><label class="block text-sm font-medium" data-key="amountLabel">Donation Amount (‚Çπ)</label><input id="amount" type="number" min="1" required class="mt-1 block w-full p-2 border rounded-md" placeholder-key="amountPlaceholder"></div>
            <div><label class="block text-sm font-medium" data-key="transactionIdLabel">UPI Transaction ID</label><input id="transactionId" class="mt-1 block w-full p-2 border rounded-md" placeholder-key="transactionIdPlaceholder"></div>
            <div><label class="block text-sm font-medium" data-key="dateLabel">Date</label><input id="donationDate" type="date" class="mt-1 block w-full p-2 border rounded-md"></div>
            <button type="submit" class="w-full bg-green-600 text-white py-2 rounded-lg" data-key="submitBtn">Submit Donation</button>
          </form>
        </section>

        <aside class="space-y-6">
          <div class="glass-card text-center">
            <h3 class="text-xl font-bold mb-2" data-key="paymentTitle">Scan to Pay</h3>
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAaVBMVEX///8AAADp6ekhISHm5ubf398nJyfAwMC6urpKSko5OTnz8/MTEw/U1NRWVlZSUlI/Pz/b29vMzMxwcHCJiYlISEgYGBhubm5gYGDAwMBPT0+cnJx6enqysrKnp6eRkZFbW1tXV1dFRUUZsykYAAAIQElEQVR4nO2d63aqPBSGgwLjgqK4KoruGNH7P+WJvQeokG1Qp/Hq+v3PMUmyfQwhIUny+Ph4PP64v1xP67P6e1O+3I/rU/x1f9v+Y3/b/15/2/6/v1z/p325f1+n/T1/1d7v+j/t2/l1r7/t2z/tT/h98fHxenx8PP54v1xP67P6e1O+3I/rU/x1f9v+Y3/b/15/2/6/v1z/p325f1+n/T1/1d7v+j/t2/l1r7/t2z/tT/h9+ePj9fzweDweD88v61N/2h/2J3zaH/an/Gl/2p/wp/1pfxrW3/Wn/Wn/Wm//tD/tT/vT/rQ/7U/70/60P+1P+9P+tD/tT/vT/rQ/7U/70/60P+1P+9P+tD/tT/vT/rQ/7U/70/60P+1P+9P+tD/tT/vT/rQ/7U/70/60P+1P+9P+tD/tT/vT/rQ/7U/70/60P+1P+9P+tD/tT/vT/rQ/7U/70/60P+1P+9P+tD/tT/vT/rQ/7U/70/60P+1P+9P+tD/tT/vT/rQ/7U/70/60P+1P+9P+tD/tT/vT/rQ/7U/70/60P+1P+9P+tD/tT/vT/rQ/7U/70/60P+1P+9P+tD/tT/vT/rQ/7U/70/60P+1P+9P+tD/tT/vT/rQ/7U/70/60P+1P+9P+tD/tT/vT/rQ/7U/7U/70/60P+1P+9P+tD/tT/vT/rQ/7U/70/60P+1P+9P+tD/tT/vT/rQ/7U/70/60P+1P+9P+tD/tT/vT/rQ/7U/70/60P+1P+9P+tD/tT/vT/rQ/7U/70/60P+1P+9P+tD/tT/vT/rQ/7U/7U/70/60P+1P+9P+tD/tT/vT/rQ/7U/7U/70/60P+1P+9P+tD/tT/vT/rQ/7U/7U/70/60P+1P+9P+tD/tT/vT/rQ/7U/7U/70/60P+1P+9P+tD/tT/vT/rQ/7U/7U/70/60P+1P+9P+tD/tT/vT/rQ/7U/7U/7U/7U/70/60P+1P+9P+tD" alt="QR" class="mx-auto rounded-lg shadow-lg w-48">
            <p class="mt-3 text-sm" data-key="paymentInstructions">After payment, enter the UPI transaction id in the form.</p>
          </div>

          <div class="glass-card">
            <h3 class="text-xl font-bold mb-2" data-key="exploreHeader">Explore More</h3>
            <div class="flex flex-col sm:flex-row gap-3">
              <button id="go-to-photos-btn" class="w-full bg-orange-500 text-white py-2 rounded-lg" data-key="photosTab">üñº Temple Photos</button>
              <button id="go-to-events-btn" class="w-full bg-orange-500 text-white py-2 rounded-lg" data-key="eventsTab">‚ú® Special Days</button>
            </div>
          </div>
        </aside>
      </div>
    </div>

    <!-- Photos page -->
    <div id="photos-page" class="hidden">
      <div class="glass-card mb-6">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-2xl font-bold" data-key="photosTabTitle">üñº Temple Photos</h2>
          <button class="back-to-home-btn bg-gray-500 text-white px-4 py-2 rounded-md" data-key="backToHomeBtn">Back to Home</button>
        </div>
        <div id="main-gallery" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4"></div>
      </div>
    </div>

    <!-- Events page -->
    <div id="events-page" class="hidden">
      <div class="glass-card mb-6">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-2xl font-bold" data-key="eventsTabTitle">‚ú® Special Days</h2>
          <button class="back-to-home-btn bg-gray-500 text-white px-4 py-2 rounded-md" data-key="backToHomeBtn">Back to Home</button>
        </div>
        <div id="main-events" class="space-y-4"></div>
      </div>
    </div>

    <!-- Admin -->
    <div id="admin-view" class="hidden no-print">
      <div class="glass-card">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-2xl font-bold" data-key="adminDashboardTitle">Admin Dashboard</h2>
          <div class="flex gap-2 items-center">
            <button id="logout-btn" class="bg-red-500 text-white px-3 py-2 rounded-md" data-key="logoutBtn">Logout</button>
          </div>
        </div>

        <div class="border-b mb-4">
          <nav class="flex gap-4">
            <button id="donors-tab-btn" class="px-3 py-2 bg-orange-100 rounded-md text-orange-700" data-key="donorsTab">Donors</button>
            <button id="photos-tab-btn" class="px-3 py-2 rounded-md" data-key="uploadPhotosTab">Upload Photos</button>
            <button id="events-tab-btn" class="px-3 py-2 rounded-md" data-key="manageEventsTab">Manage Events</button>
          </nav>
        </div>

        <div id="donors-content">
          <div class="flex justify-between items-center mb-3">
            <h3 class="font-semibold" data-key="donorsListTitle">Donors List</h3>
            <div class="flex gap-2">
              <button id="print-btn" class="bg-blue-500 text-white px-3 py-2 rounded-md" data-key="printBtn">Print</button>
              <button id="export-btn" class="bg-green-500 text-white px-3 py-2 rounded-md" data-key="exportBtn">Export CSV</button>
            </div>
          </div>
          <div id="donors-print-area" class="overflow-x-auto bg-white rounded-lg shadow p-2">
            <table class="min-w-full text-left">
              <thead class="bg-gray-100">
                <tr>
                  <th class="p-2" data-key="donorHeaderName">Name</th>
                  <th class="p-2" data-key="donorHeaderDetails">Contact</th>
                  <th class="p-2" data-key="donorHeaderAmount">Amount</th>
                  <th class="p-2" data-key="donorHeaderTransaction">Txn ID</th>
                  <th class="p-2">Actions</th>
                </tr>
              </thead>
              <tbody id="donors-table-body"></tbody>
            </table>
          </div>
        </div>

        <div id="photos-content" class="hidden">
          <h3 class="font-semibold mb-2" data-key="photoGalleryTitle">Upload Photos</h3>
          <form id="photo-upload-form" class="flex gap-2 mb-4">
            <input id="photoFile" type="file" accept="image/*" class="p-2 border rounded-md" />
            <button type="submit" class="bg-orange-500 text-white px-4 py-2 rounded-md" data-key="uploadBtn">Upload</button>
          </form>
          <p class="text-sm text-gray-600" data-key="photoManageInfo">Uploaded photos will show on the main gallery.</p>
        </div>

        <div id="events-content" class="hidden">
          <h3 class="font-semibold mb-2" data-key="specialDaysTitle">Manage Events</h3>
          <form id="event-form" class="space-y-2 mb-4">
            <input id="eventDate" type="date" class="p-2 border rounded-md w-full" required />
            <textarea id="eventDescription" rows="3" class="p-2 border rounded-md w-full" placeholder-key="eventDescPlaceholder"></textarea>
            <button type="submit" class="bg-orange-500 text-white px-4 py-2 rounded-md w-full" data-key="addEventBtn">Add Event</button>
          </form>
          <div id="admin-events-list" class="space-y-2"></div>
          <p class="text-sm text-gray-600" data-key="eventManageInfo">Events are visible to all users.</p>
        </div>
      </div>
    </div>

  </main>

  <footer class="mt-6 text-center text-sm no-print">&copy; <span id="footer-year"></span> Arulmigu Narayana Swamy Temple</footer>
</div>

<!-- Alert & Password modals -->
<div id="alert-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
  <div class="bg-white rounded-lg p-6 max-w-sm text-center">
    <p id="alert-message" class="mb-4"></p>
    <button id="alert-ok-btn" class="bg-orange-500 text-white px-4 py-2 rounded-md">OK</button>
  </div>
</div>

<div id="password-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
  <div class="bg-white rounded-lg p-6 max-w-sm">
    <h3 class="text-lg font-bold mb-2" data-key="passwordModalTitle">Admin Login</h3>
    <form id="password-form" class="space-y-3">
      <label class="block" data-key="passwordPrompt">Enter password:</label>
      <input id="admin-password" type="password" class="w-full p-2 border rounded-md" />
      <div class="flex justify-end gap-2">
        <button type="button" id="password-cancel-btn" class="px-4 py-2 bg-gray-300 rounded-md" data-key="cancelBtn">Cancel</button>
        <button type="submit" class="px-4 py-2 bg-orange-500 text-white rounded-md" data-key="loginBtn">Login</button>
      </div>
    </form>
  </div>
</div>

<!-- Firebase + App Logic -->
<script type="module">
  // ------------------------
  // IMPORTS
  // ------------------------
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getDatabase, ref, push, onValue, remove, get } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";
  import { getStorage, ref as sref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";

  // ------------------------
  // FIREBASE CONFIG - REPLACE THESE VALUES
  // ------------------------
  const firebaseConfig = {
  apiKey: "AIzaSyC7AcMsWETrrEwQTqVYL_QqFMzepMog",
  authDomain: "donation-portal-f4b2b.firebaseapp.com",
  databaseURL: "https://donation-portal-f4b2b-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "donation-portal-f4b2b",
  storageBucket: "donation-portal-f4b2b.appspot.com",
  messagingSenderId: "1105454748967",
  appId: "1:1105454748967:web:aa9de7408b64d5d8cd28de"
};

  // ------------------------
  // INIT
  // ------------------------
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const storage = getStorage(app);

  // ------------------------
  // TRANSLATIONS
  // ------------------------
  const translations = {
    en: {
      headerTitle: "Arulmigu Narayana Swamy Temple Donation Portal",
      englishBtn: "English",
      tamilBtn: "‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç",
      adminLoginLink: "Admin Login",
      formTitle: "Make a Donation",
      donorNameLabel: "Donor Name",
      donorNamePlaceholder: "Enter full name",
      addressLabel: "Address",
      addressPlaceholder: "Address (optional)",
      phoneLabel: "Phone Number",
      phonePlaceholder: "Mobile number",
      emailLabel: "Email ID",
      emailPlaceholder: "Email (optional)",
      amountLabel: "Donation Amount (‚Çπ)",
      amountPlaceholder: "Enter amount",
      transactionIdLabel: "UPI Transaction ID",
      transactionIdPlaceholder: "Enter transaction ID from UPI",
      dateLabel: "Date",
      submitBtn: "Submit Donation",
      paymentTitle: "Scan to Pay",
      paymentInstructions: "After payment, enter the UPI transaction id in the form.",
      exploreHeader: "Explore More",
      photosTab: "üñº Temple Photos",
      eventsTab: "‚ú® Special Days",
      photosTabTitle: "üñº Temple Photos",
      eventsTabTitle: "‚ú® Special Days",
      backToHomeBtn: "Back to Home",
      adminDashboardTitle: "Admin Dashboard",
      logoutBtn: "Logout",
      donorsTab: "Donors",
      uploadPhotosTab: "Upload Photos",
      manageEventsTab: "Manage Events",
      donorsListTitle: "Donors List",
      printBtn: "Print",
      exportBtn: "Export CSV",
      donorHeaderName: "Name",
      donorHeaderDetails: "Contact",
      donorHeaderAmount: "Amount",
      donorHeaderTransaction: "Txn ID",
      photoGalleryTitle: "Upload Photos",
      uploadBtn: "Upload",
      photoManageInfo: "Uploaded photos will show on the main gallery.",
      specialDaysTitle: "Manage Events",
      eventDescPlaceholder: "E.g., Vaikunta Ekadasi special",
      addEventBtn: "Add Event",
      eventManageInfo: "Events are visible to all users.",
      noEvents: "No events scheduled yet.",
      passwordModalTitle: "Admin Login",
      passwordPrompt: "Enter password:",
      cancelBtn: "Cancel",
      loginBtn: "Login",
      donationSaved: "Donation saved to cloud.",
      eventAdded: "Event added to cloud.",
      eventDeleted: "Event deleted.",
      photoUploaded: "Photo uploaded to cloud.",
      wrongPassword: "Wrong password. Access denied.",
      noDonationsExport: "No donations to export."
    },
    ta: {
      headerTitle: "‡ÆÖ‡Æ∞‡ØÅ‡Æ≥‡Øç‡ÆÆ‡Æø‡Æï‡ØÅ ‡Æ®‡Ææ‡Æ∞‡Ææ‡ÆØ‡Æ£ ‡Æö‡ØÅ‡Æµ‡Ææ‡ÆÆ‡Æø ‡Æ§‡Æø‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Øã‡Æµ‡Æø‡Æ≤‡Øç ‡Æ®‡Æ©‡Øç‡Æï‡Øä‡Æü‡Øà ‡Æ§‡Æ≥‡ÆÆ‡Øç",
      englishBtn: "English",
      tamilBtn: "‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç",
      adminLoginLink: "‡Æ®‡Æø‡Æ∞‡Øç‡Æµ‡Ææ‡Æï‡Æø ‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡Æµ‡ØÅ",
      formTitle: "‡Æ®‡Æ©‡Øç‡Æï‡Øä‡Æü‡Øà ‡ÆÖ‡Æ≥‡Æø‡ÆØ‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç",
      donorNameLabel: "‡Æ®‡Æ©‡Øç‡Æï‡Øä‡Æü‡Øà‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç",
      donorNamePlaceholder: "‡ÆÆ‡ØÅ‡Æ¥‡ØÅ‡Æ™‡Øç ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç",
      addressLabel: "‡ÆÆ‡ØÅ‡Æï‡Æµ‡Æ∞‡Æø",
      addressPlaceholder: "‡ÆÆ‡ØÅ‡Æï‡Æµ‡Æ∞‡Æø (‡Æµ‡Æø‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡Æø‡Æ©‡Ææ‡Æ≤‡Øç)",
      phoneLabel: "‡Æ§‡ØÜ‡Ææ‡Æ≤‡Øà‡Æ™‡Øá‡Æö‡Æø ‡Æé‡Æ£‡Øç",
      phonePlaceholder: "‡ÆÆ‡Øä‡Æ™‡Øà‡Æ≤‡Øç ‡Æé‡Æ£‡Øç",
      emailLabel: "‡ÆÆ‡Æø‡Æ©‡Øç‡Æ©‡Æû‡Øç‡Æö‡Æ≤‡Øç ‡ÆÆ‡ØÅ‡Æï‡Æµ‡Æ∞‡Æø",
      emailPlaceholder: "‡ÆÆ‡Æø‡Æ©‡Øç‡Æ©‡Æû‡Øç‡Æö‡Æ≤‡Øç (‡Æµ‡Æø‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡Æø‡Æ©‡Ææ‡Æ≤‡Øç)",
      amountLabel: "‡Æ®‡Æ©‡Øç‡Æï‡Øä‡Æü‡Øà‡Æ§‡Øç ‡Æ§‡Øä‡Æï‡Øà (‚Çπ)",
      amountPlaceholder: "‡Æ§‡Øä‡Æï‡Øà‡ÆØ‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç",
      transactionIdLabel: "UPI ‡Æ™‡Æ∞‡Æø‡Æµ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æ©‡Øà ‡Æê‡Æü‡Æø",
      transactionIdPlaceholder: "UPI ‡Æ™‡Æ∞‡Æø‡Æµ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æ©‡Øà ‡Æê‡Æü‡Æø‡ÆØ‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç",
      dateLabel: "‡Æ§‡Øá‡Æ§‡Æø",
      submitBtn: "‡Æ®‡Æ©‡Øç‡Æï‡Øä‡Æü‡Øà‡ÆØ‡Øà ‡Æö‡ÆÆ‡Æ∞‡Øç‡Æ™‡Øç‡Æ™‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
      paymentTitle: "‡Æ™‡Æ£‡ÆÆ‡Øç ‡Æö‡ØÜ‡Æ≤‡ØÅ‡Æ§‡Øç‡Æ§ ‡Æ∏‡Øç‡Æï‡Øá‡Æ©‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç",
      paymentInstructions: "‡Æ™‡Æ£‡ÆÆ‡Øç ‡Æö‡ØÜ‡Æ≤‡ØÅ‡Æ§‡Øç‡Æ§‡Æø‡ÆØ ‡Æ™‡Æø‡Æ±‡Æï‡ØÅ, UPI ‡Æ™‡Æ∞‡Æø‡Æµ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æ©‡Øà ‡Æê‡Æü‡Æø‡ÆØ‡Øà ‡Æ™‡Æü‡Æø‡Æµ‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Øç‡Æü‡ØÅ ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æµ‡Æø‡Æµ‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Øà‡Æö‡Øç ‡Æö‡ÆÆ‡Æ∞‡Øç‡Æ™‡Øç‡Æ™‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.",
      exploreHeader: "‡ÆÆ‡Øá‡Æ≤‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï",
      photosTab: "üñº ‡Æï‡Øã‡Æµ‡Æø‡Æ≤‡Øç ‡Æ™‡ØÅ‡Æï‡Øà‡Æ™‡Øç‡Æ™‡Æü‡Æô‡Øç‡Æï‡Æ≥‡Øç",
      eventsTab: "‚ú® ‡Æö‡Æø‡Æ±‡Æ™‡Øç‡Æ™‡ØÅ ‡Æ®‡Ææ‡Æü‡Øç‡Æï‡Æ≥‡Øç",
      photosTabTitle: "üñº ‡Æï‡Øã‡Æµ‡Æø‡Æ≤‡Øç ‡Æ™‡ØÅ‡Æï‡Øà‡Æ™‡Øç‡Æ™‡Æü‡Æô‡Øç‡Æï‡Æ≥‡Øç",
      eventsTabTitle: "‚ú® ‡Æö‡Æø‡Æ±‡Æ™‡Øç‡Æ™‡ØÅ ‡Æ®‡Ææ‡Æü‡Øç‡Æï‡Æ≥‡Øç",
      backToHomeBtn: "‡ÆÆ‡ØÅ‡Æï‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡Æö‡Øç ‡Æö‡ØÜ‡Æ≤‡Øç‡Æ≤‡Æµ‡ØÅ‡ÆÆ‡Øç",
      adminDashboardTitle: "‡Æ®‡Æø‡Æ∞‡Øç‡Æµ‡Ææ‡Æï‡Æø ‡Æü‡Ææ‡Æ∑‡Øç‡Æ™‡Øã‡Æ∞‡Øç‡Æü‡ØÅ",
      logoutBtn: "‡Æµ‡ØÜ‡Æ≥‡Æø‡ÆØ‡Øá‡Æ±‡ØÅ",
      donorsTab: "‡Æ®‡Æ©‡Øç‡Æï‡Øä‡Æü‡Øà‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç‡Æï‡Æ≥‡Øç",
      uploadPhotosTab: "‡Æ™‡ØÅ‡Æï‡Øà‡Æ™‡Øç‡Æ™‡Æü‡Æô‡Øç‡Æï‡Æ≥‡Øà ‡Æ™‡Æ§‡Æø‡Æµ‡Øá‡Æ±‡Øç‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç",
      manageEventsTab: "‡Æ®‡Æø‡Æï‡Æ¥‡Øç‡Æµ‡ØÅ‡Æï‡Æ≥‡Øà ‡Æ®‡Æø‡Æ∞‡Øç‡Æµ‡Æô‡Øç‡Æï‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
      donorsListTitle: "‡Æ®‡Æ©‡Øç‡Æï‡Øä‡Æü‡Øà‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç ‡Æ™‡Æü‡Øç‡Æü‡Æø‡ÆØ‡Æ≤‡Øç",
      printBtn: "‡ÆÖ‡Æö‡Øç‡Æö‡Æø‡Æü‡ØÅ‡Æï",
      exportBtn: "Excel-‡Æï‡Øç‡Æï‡ØÅ ‡Æè‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Æ§‡Æø ‡Æö‡ØÜ‡ÆØ‡Øç",
      donorHeaderName: "‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç",
      donorHeaderDetails: "‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æ™‡ØÅ",
      donorHeaderAmount: "‡Æ§‡Øä‡Æï‡Øà",
      donorHeaderTransaction: "‡Æ™‡Æ∞‡Æø‡Æµ‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡Æ©‡Øà ‡Æê‡Æü‡Æø",
      photoGalleryTitle: "‡Æ™‡ØÅ‡Æï‡Øà‡Æ™‡Øç‡Æ™‡Æü‡Æô‡Øç‡Æï‡Æ≥‡Øà ‡Æ™‡Æ§‡Æø‡Æµ‡Øá‡Æ±‡Øç‡Æ±‡ØÅ",
      uploadBtn: "‡Æ™‡Æ§‡Æø‡Æµ‡Øá‡Æ±‡Øç‡Æ±‡ØÅ",
      photoManageInfo: "‡Æ™‡Æ§‡Æø‡Æµ‡Øá‡Æ±‡Øç‡Æ±‡Æø‡ÆØ ‡Æ™‡ØÅ‡Æï‡Øà‡Æ™‡Øç‡Æ™‡Æü‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡ØÅ‡Æï‡Æ™‡Øç‡Æ™‡Æø‡Æ≤‡Øç ‡Æ§‡Øã‡Æ©‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç.",
      specialDaysTitle: "‡Æ®‡Æø‡Æï‡Æ¥‡Øç‡Æµ‡ØÅ‡Æï‡Æ≥‡Øà ‡Æ®‡Æø‡Æ∞‡Øç‡Æµ‡Æô‡Øç‡Æï‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
      eventDescPlaceholder: "‡Æé.‡Æï‡Ææ., ‡Æµ‡Øà‡Æï‡ØÅ‡Æ£‡Øç‡Æü ‡Æè‡Æï‡Ææ‡Æ§‡Æö‡Æø ‡Æö‡Æø‡Æ±‡Æ™‡Øç‡Æ™‡ØÅ ‡Æ™‡ØÇ‡Æú‡Øà",
      addEventBtn: "‡Æ®‡Æø‡Æï‡Æ¥‡Øç‡Æµ‡Øà‡Æö‡Øç ‡Æö‡Øá‡Æ∞‡Øç",
      eventManageInfo: "‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü ‡Æ®‡Æø‡Æï‡Æ¥‡Øç‡Æµ‡ØÅ‡Æï‡Æ≥‡Øç ‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Ææ‡Æ© ‡Æ™‡ÆØ‡Æ©‡Æ∞‡Øç‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç ‡Æ§‡Øã‡Æ©‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç.",
      noEvents: "‡Æá‡Æ©‡Øç‡Æ©‡ØÅ‡ÆÆ‡Øç ‡Æ®‡Æø‡Æï‡Æ¥‡Øç‡Æµ‡ØÅ‡Æï‡Æ≥‡Øç ‡Æ§‡Æø‡Æü‡Øç‡Æü‡ÆÆ‡Æø‡Æü‡Æ™‡Øç‡Æ™‡Æü‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà.",
      passwordModalTitle: "‡Æ®‡Æø‡Æ∞‡Øç‡Æµ‡Ææ‡Æï‡Æø ‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡Æµ‡ØÅ",
      passwordPrompt: "‡Æ®‡Æø‡Æ∞‡Øç‡Æµ‡Ææ‡Æï‡Æø ‡Æï‡Æü‡Æµ‡ØÅ‡Æö‡Øç‡Æö‡Øä‡Æ≤‡Øç‡Æ≤‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç:",
      cancelBtn: "‡Æ∞‡Æ§‡Øç‡Æ§‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç",
      loginBtn: "‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà",
      donationSaved: "‡Æ®‡Æ©‡Øç‡Æï‡Øä‡Æü‡Øà ‡ÆÆ‡Øá‡Æï‡ÆÆ‡Øç-‡ÆÆ‡Øá‡Æ≤‡Øç ‡Æö‡Øá‡ÆÆ‡Æø‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ.",
      eventAdded: "‡Æ®‡Æø‡Æï‡Æ¥‡Øç‡Æµ‡ØÅ ‡ÆÆ‡Øá‡Æï‡ÆÆ‡Øç-‡ÆÆ‡Øá‡Æ≤‡Øç ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ.",
      eventDeleted: "‡Æ®‡Æø‡Æï‡Æ¥‡Øç‡Æµ‡ØÅ ‡Æ®‡ØÄ‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ.",
      photoUploaded: "‡Æ™‡ØÅ‡Æï‡Øà‡Æ™‡Øç‡Æ™‡Æü‡ÆÆ‡Øç ‡ÆÆ‡Øá‡Æï‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡Æ™‡Æ§‡Æø‡Æµ‡Øá‡Æ±‡Øç‡Æ±‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ.",
      wrongPassword: "‡Æ§‡Æµ‡Æ±‡Ææ‡Æ© ‡Æï‡Æü‡Æµ‡ØÅ‡Æö‡Øç‡Æö‡Øä‡Æ≤‡Øç. ‡ÆÖ‡Æ£‡ØÅ‡Æï‡Æ≤‡Øç ‡ÆÆ‡Æ±‡ØÅ‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ.",
      noDonationsExport: "‡Æè‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Æ§‡Æø ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ ‡Æ®‡Æ©‡Øç‡Æï‡Øä‡Æü‡Øà‡Æï‡Æ≥‡Øç ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà."
    }
  };

  let currentLanguage = 'en';

  // Helper to set text from translations
  function switchLanguage(lang) {
    currentLanguage = lang;
    document.documentElement.lang = (lang === 'ta') ? 'ta' : 'en';
    // Update data-key text contents
    document.querySelectorAll('[data-key]').forEach(el => {
      const key = el.dataset.key;
      if (translations[lang][key] !== undefined) el.textContent = translations[lang][key];
    });
    // Update placeholders
    document.querySelectorAll('[placeholder-key]').forEach(el => {
      const pkey = el.getAttribute('placeholder-key');
      if (translations[lang][pkey] !== undefined) el.placeholder = translations[lang][pkey];
    });
    // Rerender events for language-specific dates
    renderPublicEventsLatest();
    renderAdminEventsLatest();
  }

  // ------------------------
  // UI elements
  // ------------------------
  const alertModal = document.getElementById('alert-modal');
  const passwordModal = document.getElementById('password-modal');
  const showAlert = (msg) => {
    document.getElementById('alert-message').textContent = msg;
    alertModal.classList.remove('hidden'); alertModal.classList.add('flex');
  };

  document.getElementById('alert-ok-btn').addEventListener('click', ()=> alertModal.classList.add('hidden'));

  // ------------------------
  // DONATION SUBMIT
  // ------------------------
  document.getElementById('donation-form').addEventListener('submit', e => {
    e.preventDefault();
    const data = {
      donorName: document.getElementById('donorName').value || '',
      address: document.getElementById('address').value || '',
      phone: document.getElementById('phone').value || '',
      email: document.getElementById('email').value || '',
      amount: document.getElementById('amount').value || '',
      transactionId: document.getElementById('transactionId').value || '',
      date: document.getElementById('donationDate').value || new Date().toISOString().slice(0,10)
    };
    push(ref(db, 'donations'), data)
      .then(()=> showAlert(translations[currentLanguage].donationSaved))
      .catch(e => showAlert('Error: ' + e.message));
    e.target.reset();
  });

  // ------------------------
  // DONORS LIVE LIST (admin table)
  // ------------------------
  const donorsTableBody = document.getElementById('donors-table-body');
  const donationsRef = ref(db,'donations');
  onValue(donationsRef, snapshot => {
    const data = snapshot.val();
    donorsTableBody.innerHTML = '';
    if (data) {
      Object.keys(data).forEach(key => {
        const d = data[key];
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="p-2 border">${escapeHtml(d.donorName || '')}<br><small>${escapeHtml(d.address||'')}</small></td>
          <td class="p-2 border">${escapeHtml(d.phone||'')}<br><small>${escapeHtml(d.email||'')}</small></td>
          <td class="p-2 border">‚Çπ${escapeHtml(d.amount||'')}</td>
          <td class="p-2 border">${escapeHtml(d.transactionId||'')}</td>
          <td class="p-2 border"><button data-key="${key}" class="delete-donation bg-red-500 text-white px-2 py-1 rounded">Delete</button></td>
        `;
        donorsTableBody.appendChild(tr);
      });
      document.querySelectorAll('.delete-donation').forEach(btn => {
        btn.addEventListener('click', () => {
          if (confirm('Delete this donation?')) remove(ref(db, 'donations/' + btn.dataset.key));
        });
      });
    } else {
      donorsTableBody.innerHTML = `<tr><td colspan="5" class="p-4 text-gray-500">${translations[currentLanguage].noDonations || 'No donations yet.'}</td></tr>`;
    }
  });

  // ------------------------
  // PHOTOS UPLOAD / GALLERY
  // ------------------------
  document.getElementById('photo-upload-form').addEventListener('submit', (e) => {
    e.preventDefault();
    const file = document.getElementById('photoFile').files[0];
    if (!file) { showAlert('Select a photo first.'); return; }
    const path = `photos/${Date.now()}_${file.name}`;
    const storageRef = sref(storage, path);
    const uploadTask = uploadBytesResumable(storageRef, file);
    uploadTask.on('state_changed',
      null,
      (err) => showAlert('Upload failed: ' + err.message),
      () => {
        getDownloadURL(uploadTask.snapshot.ref).then(url => {
          push(ref(db, 'photos'), { url, name: file.name, uploadedAt: new Date().toISOString() })
            .then(()=> showAlert(translations[currentLanguage].photoUploaded))
            .catch(e=> showAlert('Error saving photo meta: ' + e.message));
        });
      }
    );
    e.target.reset();
  });

  const galleryEl = document.getElementById('main-gallery');
  onValue(ref(db,'photos'), snapshot => {
    const data = snapshot.val();
    galleryEl.innerHTML = '';
    if (data) {
      Object.values(data).forEach(photo => {
        const img = document.createElement('img');
        img.src = photo.url;
        img.alt = photo.name || 'temple photo';
        img.className = 'w-full h-48 object-cover rounded-lg shadow';
        galleryEl.appendChild(img);
      });
    } else {
      galleryEl.innerHTML = '<p class="text-center col-span-full text-gray-500">No photos uploaded yet.</p>';
    }
  });

  // ------------------------
  // EVENTS: add, render (public & admin), delete
  // ------------------------
  // Add event
  document.getElementById('event-form').addEventListener('submit', e => {
    e.preventDefault();
    const data = { date: document.getElementById('eventDate').value, description: document.getElementById('eventDescription').value || '' };
    push(ref(db,'events'), data)
      .then(()=> showAlert(translations[currentLanguage].eventAdded))
      .catch(e=> showAlert('Error: ' + e.message));
    e.target.reset();
  });

  // Keep latest snapshots for re-render in current language
  let latestEventsSnapshot = null;

  // Render public events (localized date)
  function renderPublicEventsLatest() {
    const list = document.getElementById('main-events');
    const data = latestEventsSnapshot || {};
    const arr = Object.keys(data).map(k => ({ key: k, ...data[k] })).sort((a,b)=> new Date(a.date) - new Date(b.date));
    if (!arr.length) {
      list.innerHTML = `<p class="text-center text-gray-500">${translations[currentLanguage].noEvents}</p>`;
      return;
    }
    list.innerHTML = arr.map(e => {
      const dateStr = e.date ? new Date(e.date).toLocaleDateString(currentLanguage === 'ta' ? 'ta-IN' : 'en-US') : '';
      return `<div class="bg-white/60 p-3 rounded"><p class="font-bold text-orange-700">${escapeHtml(dateStr)}</p><p>${escapeHtml(e.description)}</p></div>`;
    }).join('');
  }

  // Render admin events list with delete buttons
  function renderAdminEventsLatest() {
    const container = document.getElementById('admin-events-list');
    const data = latestEventsSnapshot || {};
    const arr = Object.keys(data).map(k => ({ key: k, ...data[k] })).sort((a,b)=> new Date(a.date) - new Date(b.date));
    if (!arr.length) {
      container.innerHTML = `<p class="text-gray-500">${translations[currentLanguage].noEvents}</p>`;
      return;
    }
    container.innerHTML = arr.map(e => {
      const dateStr = e.date ? new Date(e.date).toLocaleDateString(currentLanguage === 'ta' ? 'ta-IN' : 'en-US') : '';
      return `<div class="flex items-start justify-between bg-white/70 p-3 rounded">
                <div>
                  <p class="font-bold text-orange-700">${escapeHtml(dateStr)}</p>
                  <p>${escapeHtml(e.description)}</p>
                </div>
                <div>
                  <button data-key="${e.key}" class="delete-event bg-red-500 text-white px-3 py-1 rounded">Delete</button>
                </div>
              </div>`;
    }).join('');
    // wire delete buttons
    document.querySelectorAll('.delete-event').forEach(btn => {
      btn.addEventListener('click', () => {
        if (confirm('Delete this event?')) {
          remove(ref(db,'events/' + btn.dataset.key))
            .then(()=> showAlert(translations[currentLanguage].eventDeleted))
            .catch(e=> showAlert('Error deleting: ' + e.message));
        }
      });
    });
  }

  // Subscribe to events changes
  const eventsRef = ref(db,'events');
  onValue(eventsRef, snapshot => {
    latestEventsSnapshot = snapshot.val() || {};
    renderPublicEventsLatest();
    renderAdminEventsLatest();
  });

  // ------------------------
  // ADMIN LOGIN (simple client-side) - for production: use Firebase Auth
  // ------------------------
  const adminPassword = 'password123'; // change this if needed
  document.getElementById('admin-login-link').addEventListener('click', (ev) => { ev.preventDefault(); passwordModal.classList.remove('hidden'); passwordModal.classList.add('flex'); });
  document.getElementById('password-cancel-btn').addEventListener('click', ()=> passwordModal.classList.add('hidden'));
  document.getElementById('password-form').addEventListener('submit', (e) => {
    e.preventDefault();
    const val = document.getElementById('admin-password').value;
    if (val === adminPassword) {
      passwordModal.classList.add('hidden'); showPage('admin-view'); showAdminTab('donors');
    } else {
      showAlert(translations[currentLanguage].wrongPassword);
    }
  });

  // ------------------------
  // ADMIN UI TAB SWITCH
  // ------------------------
  function showPage(id) {
    ['home-page','photos-page','events-page','admin-view'].forEach(p => document.getElementById(p).classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
  }
  function showAdminTab(name) {
    document.getElementById('donors-content').classList.toggle('hidden', name!=='donors');
    document.getElementById('photos-content').classList.toggle('hidden', name!=='photos');
    document.getElementById('events-content').classList.toggle('hidden', name!=='events');
    // highlight
    ['donors-tab-btn','photos-tab-btn','events-tab-btn'].forEach(id => document.getElementById(id).classList.remove('bg-orange-100','text-orange-700'));
    if (name==='donors') document.getElementById('donors-tab-btn').classList.add('bg-orange-100','text-orange-700');
    if (name==='photos') document.getElementById('photos-tab-btn').classList.add('bg-orange-100','text-orange-700');
    if (name==='events') document.getElementById('events-tab-btn').classList.add('bg-orange-100','text-orange-700');
  }
  document.getElementById('donors-tab-btn').addEventListener('click', ()=> showAdminTab('donors'));
  document.getElementById('photos-tab-btn').addEventListener('click', ()=> showAdminTab('photos'));
  document.getElementById('events-tab-btn').addEventListener('click', ()=> showAdminTab('events'));

  // Navigation
  document.getElementById('go-to-photos-btn').addEventListener('click', ()=> showPage('photos-page'));
  document.getElementById('go-to-events-btn').addEventListener('click', ()=> showPage('events-page'));
  document.querySelectorAll('.back-to-home-btn').forEach(b=> b.addEventListener('click', ()=> showPage('home-page')));

  // Print & Export
  document.getElementById('print-btn').addEventListener('click', ()=> window.print());
  document.getElementById('export-btn').addEventListener('click', exportDonationsCSV);

  async function exportDonationsCSV() {
    try {
      const snap = await get(ref(db,'donations'));
      const data = snap.val();
      if (!data) { showAlert(translations[currentLanguage].noDonationsExport); return; }
      const rows = [['Donor Name','Address','Phone','Email','Amount','TxnID','Date']];
      Object.values(data).forEach(d => rows.push([d.donorName||'', d.address||'', d.phone||'', d.email||'', d.amount||'', d.transactionId||'', d.date||'']));
      const csv = rows.map(r => r.map(cell => `"${String(cell).replace(/"/g,'""')}"`).join(',')).join('\r\n');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'donations.csv'; a.click();
      URL.revokeObjectURL(url);
    } catch (e) { showAlert('Export failed: ' + e.message); }
  }

  // ------------------------
  // HELPERS
  // ------------------------
  function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]); }); }

  // Footer year
  document.getElementById('footer-year').textContent = new Date().getFullYear();

  // Wire language buttons
  document.getElementById('en-lang-btn').addEventListener('click', ()=> switchLanguage('en'));
  document.getElementById('ta-lang-btn').addEventListener('click', ()=> switchLanguage('ta'));

  // Initial state
  switchLanguage('en');
  showPage('home-page');
</script>

</body>
</html>
